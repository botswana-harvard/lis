import socket
from astm_classes.constants import ACK, ENQ, EOT
from config.base_socket_config import TCP_IP, TCP_PORT, BUFFER_SIZE
import time

class Server:


    MESSAGE = ["1H|\^&|||PSM^Roche Diagnostics^PSM^2.01.00.c|||||||P||20150108072227",
               "2P|1|WT33721|||^||||||||||||||||||20150108072200|||||||||",
               "3O|1|WT33721||ALL|R|20150108072200|||||X||||1||||||||||F",
               "4R|1|^^^ALPL^^^^148.1|44.42893|||N||F||^System||20150107072208|148.1",
               "5R|2|^^^CL-I^^^^148.1|105.0383|||N||F||^System||20150107072206|148.1",
                "6R|3|^^^CO2-L^^^^148.1|16.95361|||N||F||^System||20150107072207|148.1",
                "7R|4|^^^CREJ^^^^148.1|62.69189|||N||F||^System||20150107072209|148.1",
                "0R|5|^^^NA-I^^^^148.1|132.5616|||N||F||^System||20150107072205|148.1",
                "1R|6|^^^PHOS^^^^148.1|1.597954|||N||F||^System||20150107072208|148.1",
                "2R|7|^^^UREL^^^^148.1|3.188942|||N||F||^System||20150107072207|148.1",
                "3P|2|WT36840|||^||||||||||||||||||20150108072200|||||||||",
                "4O|1|WT36840||ALL|R|20150108072200|||||X||||1||||||||||F",
                "5R|1|^^^ALPL^^^^148.1|67.95654|||N||F||^System||20150107072213|148.1",
                "6R|2|^^^ALTL^^^^148.1|10.55941|||N||F||^System||20150107072212|148.1",
                "7R|3|^^^CL-I^^^^148.1|106.7179|||N||F||^System||20150107072211|148.1",
                "0R|4|^^^CO2-L^^^^148.1|20.16562|||N||F||^System||20150107072211|148.1",
                "1R|5|^^^CREJ^^^^148.1|56.58432|||N||F||^System||20150107072214|148.1",
                "2R|6|^^^K-I^^^^148.1|4.395318|||N||F||^System||20150107072210|148.1",
                "3R|7|^^^NA-I^^^^148.1|136.6808|||N||F||^System||20150107072209|148.1",
                "4R|8|^^^PHOS^^^^148.1|1.356225|||N||F||^System||20150107072213|148.1",
                "5R|9|^^^UREL^^^^148.1|4.367106|||N||F||^System||20150107072212|148.1",
                "6P|3|WT36862|||^||||||||||||||||||20150108072200|||||||||",
                "7O|1|WT36862||ALL|R|20150108072200|||||X||||1||||||||||F",
                "0R|1|^^^ALTL^^^^148.1|11.77982|||N||F||^System||20150107072215|148.1",
                "1R|2|^^^CL-I^^^^148.1|104.1204|||N||F||^System||20150107072217|148.1",
                "2R|3|^^^CO2-L^^^^148.1|24.79081|||N||F||^System||20150107072215|148.1",
                "3R|4|^^^GLUL^^^^148.1|5.252485|||N||F||^System||20150107072220|148.1",
                "4R|5|^^^K-I^^^^148.1|5.143091|||N||F||^System||20150107072217|148.1",
                "5R|6|^^^LDL_C^^^^148.1|2.988824|||N||F||^System||20150107072218|148.1",
                "6R|7|^^^NA-I^^^^148.1|137.1147|||N||F||^System||20150107072216|148.1",
                "7R|8|^^^PHOS^^^^148.1|1.020399|||N||F||^System||20150107072222|148.1",
                "0R|9|^^^TRIGL^^^^148.1|1.44269|||N||F||^System||20150107072219|148.1",
                "1R|10|^^^UREL^^^^148.1|4.028677|||N||F||^System||20150107072219|148.1",
                "2R|11|^^^CHOLL^^^^148.1|4.236707|||N||F||^System||20150107072216|148.1",
                "3P|4|WT36878|||^||||||||||||||||||20150108072200|||||||||",
                "4O|1|WT36878||ALL|R|20150108072200|||||X||||1||||||||||F",
                "5R|1|^^^CL-I^^^^148.1|100.8204|||N||F||^System||20150107072221|148.1",
                "6R|2|^^^K-I^^^^148.1|3.768953|||N||F||^System||20150107072221|148.1",
                "7R|3|^^^NA-I^^^^148.1|132.5778|||N||F||^System||20150107072220|148.1",
                "0P|5|WT33721|||^||||||||||||||||||20150108072200|||||||||",
                "1O|1|WT33721||ALL|R|20150108072200|||||X||||1||||||||||F",
                "2R|1|^^^K-I^^^^148.1|4.409888|||N||F||^System||20150107072223|148.1",
                "3P|6|WT35218|||^||||||||||||||||||20150108072200|||||||||",
                "4O|1|WT35218||ALL|R|20150108072200|||||X||||1||||||||||F",
                "5R|1|^^^CHOLL^^^^148.1|4.668506|||N||F||^System||20150107072222|148.1",
                "6P|7|WT35218|||^||||||||||||||||||20150108072200|||||||||",
                "7O|1|WT35218||ALL|R|20150108072200|||||X||||1||||||||||F",
                "0R|1|^^^ALPL^^^^148.1|87.75783|||N||F||^System||20150107072233|148.1",
                "1R|2|^^^ALTL^^^^148.1|11.22675|||N||F||^System||20150107072226|148.1",
                "2R|3|^^^ASTL^^^^148.1|18.72154|||N||F||^System||20150107072226|148.1",
                "3R|4|^^^CL-I^^^^148.1|98.93016|||N||F||^System||20150107072228|148.1",
                "4R|5|^^^CO2-L^^^^148.1|20.10066|||N||F||^System||20150107072225|148.1",
                "5R|6|^^^CREJ^^^^148.1|45.3102|||N||F||^System||20150107072235|148.1",
                "6R|7|^^^GLUL^^^^148.1|4.51465|||N||F||^System||20150107072232|148.1",
                "7R|8|^^^HDL_C^^^^148.1|1.239484|||N||F||^System||20150107072233|148.1",
                "0R|9|^^^K-I^^^^148.1|4.589446|||N||F||^System||20150107072228|148.1",
                "1R|10|^^^LDL_C^^^^148.1|3.030988|||N||F||^System||20150107072224|148.1",
                "2R|11|^^^NA-I^^^^148.1|131.9533|||N||F||^System||20150107072227|148.1",
                "3R|12|^^^PHOS^^^^148.1|.995455|||N||F||^System||20150107072232|148.1",
                "4R|13|^^^TRIGL^^^^148.1|1.666309|||N||F||^System||20150107072229|148.1",
                "5R|14|^^^UREL^^^^148.1|2.205843|||N||F||^System||20150107072229|148.1",
                "6P|8|WT35224|||^||||||||||||||||||20150108072200|||||||||",
                "7O|1|WT35224||ALL|R|20150108072200|||||X||||1||||||||||F",
                "0R|1|^^^CL-I^^^^148.1|102.1722|||N||F||^System||20150107072239|148.1",
                "1R|2|^^^K-I^^^^148.1|3.964968|||N||F||^System||20150107072238|148.1",
                "2R|3|^^^NA-I^^^^148.1|135.5206|||N||F||^System||20150107072238|148.1",
                "3P|9|WT35268|||^||||||||||||||||||20150108072200|||||||||",
                "4O|1|WT35268||ALL|R|20150108072200|||||X||||1||||||||||F",
                "5R|1|^^^CL-I^^^^148.1|102.1099|||N||F||^System||20150107072243|148.1",
                "6R|2|^^^K-I^^^^148.1|4.765465|||N||F||^System||20150107072242|148.1",
                "7R|3|^^^NA-I^^^^148.1|130.3409|||N||F||^System||20150107072242|148.1",
                "0P|10|WT35296|||^||||||||||||||||||20150108072200|||||||||",
                "1O|1|WT35296||ALL|R|20150108072200|||||X||||1||||||||||F",
                "2R|1|^^^ALPL^^^^148.1|101.7409|||N||F||^System||20150107072241|148.1",
                "3R|2|^^^ALTL^^^^148.1|27.22145|||N||F||^System||20150107072237|148.1",
                "4R|3|^^^ASTL^^^^148.1|35.94989|||N||F||^System||20150107072237|148.1",
                "5R|4|^^^CL-I^^^^148.1|104.987|||N||F||^System||20150107072231|148.1",
                "6R|5|^^^CO2-L^^^^148.1|19.25623|||N||F||^System||20150107072236|148.1",
                "7R|6|^^^K-I^^^^148.1|4.047256|||N||F||^System||20150107072230|148.1",
                "0R|7|^^^NA-I^^^^148.1|138.4485|||N||F||^System||20150107072230|148.1",
                "1R|8|^^^PHOS^^^^148.1|1.269373|||N||F||^System||20150107072240|148.1",
                "2R|9|^^^BIL-T^^^^148.1|3.988255|||N||F||^System||20150107072240|148.1",
                "3R|10|^^^ALB2^^^^148.1|43.64628|||N||F||^System||20150107072239|148.1",
                "4L|1|N"]

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.bind((TCP_IP, TCP_PORT))
    s.listen(1)
    while 1:
        conn, addr = s.accept()
        conn.send(ENQ)  # Send an ENQ to check if the client is ready to receive
        for i in MESSAGE:
            data = conn.recv(BUFFER_SIZE)
            if data == ACK:
                conn.send(i)
                time.sleep(10)
            if data == EOT:
                s.listen(1)
    conn.close()
